

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; parakeet 0.1.dev1+g8c368a0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=381b7a04"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Publications" href="publications.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            parakeet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Command line programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generate-a-new-configuration-file">Generate a new configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#edit-the-configuration-file">Edit the configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-sample-model">Generate sample model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulate-em-images">Simulate EM images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#export-functions">Export functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-functions">Analysis functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">parakeet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading"></a></h1>
<p>Simulation of datasets is split into a number of different commands. Each
command takes a set of command line options or a configuration file in YAML
format.</p>
<section id="generate-a-new-configuration-file">
<h2>Generate a new configuration file<a class="headerlink" href="#generate-a-new-configuration-file" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.config.new
</pre></div>
</div>
<p>This will generate a new file called config.yaml which will contain the
following configuration.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">microscope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">beam</span><span class="p">:</span>
<span class="w">    </span><span class="nt">electrons_per_angstrom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">    </span><span class="nt">energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="w">    </span><span class="nt">source_spread</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">detector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">ny</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">pixel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">lens</span><span class="p">:</span>
<span class="w">    </span><span class="nt">c_10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-20000</span>
<span class="w">    </span><span class="nt">c_30</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.7</span>
<span class="w">    </span><span class="nt">c_c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.7</span>
<span class="nt">sample</span><span class="p">:</span>
<span class="w">  </span><span class="nt">box</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="nt">centre</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="nt">molecules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">shape</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cube</span><span class="p">:</span>
<span class="w">      </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">    </span><span class="nt">cuboid</span><span class="p">:</span>
<span class="w">      </span><span class="nt">length_x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">length_y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">length_z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">    </span><span class="nt">cylinder</span><span class="p">:</span>
<span class="w">      </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">radius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500.0</span>
<span class="w">    </span><span class="nt">margin</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cube</span>
<span class="nt">scan</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">still</span>
<span class="w">  </span><span class="nt">num_images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">start_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">step_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">simulation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ice</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</section>
<section id="edit-the-configuration-file">
<h2>Edit the configuration file<a class="headerlink" href="#edit-the-configuration-file" title="Link to this heading"></a></h2>
<p>The configuration file now needs to be edited to perform the desired
simulation. For example, to simulate with a single molecule we modify the
sample.molecules field as follows.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">microscope</span><span class="p">:</span>
<span class="w">  </span><span class="nt">beam</span><span class="p">:</span>
<span class="w">    </span><span class="nt">electrons_per_angstrom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">    </span><span class="nt">energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="w">    </span><span class="nt">source_spread</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">detector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">ny</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">pixel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">lens</span><span class="p">:</span>
<span class="w">    </span><span class="nt">c_10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-20000</span>
<span class="w">    </span><span class="nt">c_30</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.7</span>
<span class="w">    </span><span class="nt">c_c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.7</span>
<span class="nt">sample</span><span class="p">:</span>
<span class="w">  </span><span class="nt">box</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="nt">centre</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="nt">molecules</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pdb</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4v1w</span>
<span class="w">        </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">shape</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cube</span><span class="p">:</span>
<span class="w">      </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">    </span><span class="nt">cuboid</span><span class="p">:</span>
<span class="w">      </span><span class="nt">length_x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">length_y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">length_z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">    </span><span class="nt">cylinder</span><span class="p">:</span>
<span class="w">      </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">radius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500.0</span>
<span class="w">    </span><span class="nt">margin</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cube</span>
<span class="nt">scan</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">still</span>
<span class="w">  </span><span class="nt">num_images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">start_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">step_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">simulation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ice</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</section>
<section id="generate-sample-model">
<h2>Generate sample model<a class="headerlink" href="#generate-sample-model" title="Link to this heading"></a></h2>
<p>Once the configuration file has been generated a new sample file can be created
with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.sample.new<span class="w"> </span>-c<span class="w"> </span>config.yaml
</pre></div>
</div>
<p>This will result in a file “sample.h5” being generated. This file contains
information about the size and shape of the sample but as yet doesn’t contain
any atomic coordinates. The atomic model is added by running the following
command which adds molecules to the sample file. If a single molcule is
specified then it will be placed in the centre of the sample volume. If
multiple molecules are specified then the molecules will be positioned at
random locations in the sample volume. This command will update the “sample.h5”
file with the atomic coordinates but will not generated any new files.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.sample.add_molecules<span class="w"> </span>-c<span class="w"> </span>config.yaml
</pre></div>
</div>
</section>
<section id="simulate-em-images">
<h2>Simulate EM images<a class="headerlink" href="#simulate-em-images" title="Link to this heading"></a></h2>
<p>Once the atomic model is ready, the EM images can be simulated with the
following commands. Each stage of the simulation is separated because it may be
desirable to simulate many different defocused images from the sample exit wave
for example or many different doses for the sample defocusses image. Being
separate, the output of one stage can be reused for multiple runs of the next
stage. The first stage is to simulate the exit wave. This is the propagation of
the electron wave through the sample. It is therefore the most computationally
intensive part of the processes since the contribution of all atoms within the
sample needs to be calculated.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.simulate.exit_wave<span class="w"> </span>-c<span class="w"> </span>config.yaml
</pre></div>
</div>
<p>This command will generate a file “exit_wave.h5” which will contain the exit
wave of all tilt angles. The next step is to simulate the micropscope optics
which is done with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.simulate.optics<span class="w"> </span>-c<span class="w"> </span>config.yaml
</pre></div>
</div>
<p>This step is much quicker as it only scales with the size of the detector image
and doesn’t require the atomic coordinates again. The command will output a
file “optics.h5”. Finally, the response of the detector can be simulated with
the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.simulate.image<span class="w"> </span>-c<span class="w"> </span>config.yaml
</pre></div>
</div>
<p>This command will add the detector DQE and the Poisson noise for a given dose
and will output a file “image.h5”.</p>
</section>
<section id="export-functions">
<h2>Export functions<a class="headerlink" href="#export-functions" title="Link to this heading"></a></h2>
<p>Typically we cant to output an MRC file for further processing. The hdf5 files
can easily be exported to MRC by the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.export<span class="w"> </span>file.h5<span class="w"> </span>-o<span class="w"> </span>file.mrc
</pre></div>
</div>
<p>The export command can also be used to rebin the image or select a region of interest.</p>
</section>
<section id="analysis-functions">
<h2>Analysis functions<a class="headerlink" href="#analysis-functions" title="Link to this heading"></a></h2>
<p>The reconstruction function can be called in Parakeet in the following way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.export<span class="w"> </span>image.h5<span class="w"> </span>-o<span class="w"> </span>image.mrc
parakeet.analyse.reconstruct<span class="w"> </span>-c<span class="w"> </span>config.yaml<span class="w"> </span>-i<span class="w"> </span>image.mrc
</pre></div>
</div>
<p>Averaging of the particles can then be done with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parakeet.analyse.average_particles<span class="w"> </span>-c<span class="w"> </span>config.yaml
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="publications.html" class="btn btn-neutral float-right" title="Publications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, James Parkhurst.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>